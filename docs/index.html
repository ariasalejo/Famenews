<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Famnews - Noticias Dinámicas</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos Base */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --text-color: #333;
            --light-bg: #f8f9fa;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
        }

        /* Header */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
        }

        /* Contenedor Principal */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Menú de Categorías */
        .category-menu {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .category-item {
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            background-color: white;
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s ease;
            border: 2px solid var(--primary-color);
            font-weight: 500;
        }

        .category-item:hover,
        .category-item.active {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        /* Contenedor de Noticias */
        #news-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 1rem;
        }

        /* Tarjetas de Noticias */
        .news-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: transform 0.3s ease;
            position: relative;
            box-shadow: var(--box-shadow);
        }

        .news-card:hover {
            transform: translateY(-5px);
        }

        .news-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 3px solid var(--secondary-color);
        }

        .card-content {
            padding: 1.5rem;
        }

        .news-card h3 {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            color: var(--primary-color);
        }

        .news-card p {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 1.2rem;
        }

        .read-more {
            display: inline-block;
            color: var(--secondary-color);
            font-weight: 500;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .read-more:hover {
            color: var(--accent-color);
        }

        /* Diseño Responsive */
        @media (min-width: 768px) {
            .news-card.large {
                grid-column: span 2;
            }

            .news-card.medium {
                grid-column: span 1;
            }
        }

        /* Loader */
        #loader {
            display: none;
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: var(--secondary-color);
        }

        /* Footer */
        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: 3rem;
        }

        /* Mejoras de Imágenes */
        .news-card .image-placeholder {
            height: 200px;
            background: linear-gradient(45deg, #f1f1f1, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Famnews - Últimas Noticias</h1>
    </header>
    
    <div class="container">
        <nav class="category-menu">
            <a href="#" data-category="trending" class="category-item active">Tendencias</a>
            <a href="#" data-category="business" class="category-item">Negocios</a>
            <a href="#" data-category="technology" class="category-item">Tecnología</a>
            <a href="#" data-category="health" class="category-item">Salud</a>
            <a href="#" data-category="entertainment" class="category-item">Entretenimiento</a>
        </nav>
        
        <div id="loader">Cargando noticias...</div>
        <div id="news-container"></div>
    </div>

    <footer>
        <p>&copy; <span id="current-year"></span> Famnews. Todos los derechos reservados.</p>
    </footer>

    <script>
// --- API Configuration ---
const BASE_URL = 'http://127.0.0.1:5000/api/rss_news'; // URL de tu endpoint local de Flask

// --- DOM Elements ---
const loader = document.getElementById('loader');
const newsContainer = document.getElementById('news-container');
const categoryItems = document.querySelectorAll('.category-item');
const categoryHeading = document.getElementById('category-heading');

// Mapear categorías a URLs de feeds RSS
const rssFeedUrls = {
  'trending': 'https://news.ycombinator.com/rss', // Feed Hacker News como ejemplo
  'business': 'http://feeds.bbci.co.uk/news/business/rss.xml',
  'technology': 'http://feeds.bbci.co.uk/news/technology/rss.xml',
  'health': 'http://feeds.bbci.co.uk/news/health/rss.xml',
  'entertainment': 'http://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml',
};

const defaultCategory = 'trending';

// --- Event Listeners ---
document.addEventListener('DOMContentLoaded', () => {
  loadNews(defaultCategory);
  document.getElementById('current-year').textContent = new Date().getFullYear();
});

categoryItems.forEach(item => item.addEventListener('click', e => {
  e.preventDefault();
  categoryItems.forEach(i => i.classList.remove('active'));
  e.target.classList.add('active');

  const clickedCategoryText = e.target.textContent;
  categoryHeading.textContent = clickedCategoryText;

  loadNews(e.target.dataset.category);
}));

// --- Load News ---
async function loadNews(category = defaultCategory) {
  loader.style.display = 'block';
  newsContainer.innerHTML = '';

  const rssUrlToFetch = rssFeedUrls[category];

  if (!rssUrlToFetch) {
    showError(`No se encontró URL de feed RSS para la categoría: ${category}`);
    loader.style.display = 'none';
    return;
  }

  const url = `${BASE_URL}?url=${encodeURIComponent(rssUrlToFetch)}`;

  try {
    const response = await fetch(url);

    if (!response.ok) {
      const errorData = await response.json();
      console.error("Error HTTP desde el backend", response.status, errorData);
      throw new Error(`Error en el Backend ${response.status}: ${errorData.message || 'Error desconocido'}`);
    }

    const data = await response.json();

    if (data.status === "ok" && data.articles && data.articles.length > 0) {
      renderNews(data.articles);
    } else if (data.status === "error") {
      showError(`Backend reportó un error: ${data.message}`);
    } else {
      showError('No se devolvieron artículos del backend para este feed.');
    }
  } catch (err) {
    console.error("Error al obtener noticias desde el backend:", err);
    showError(`Error cargando noticias desde el backend. Detalles: ${err.message}`);
  } finally {
    loader.style.display = 'none';
  }
}

// --- Render News ---
function renderNews(articles) {
  let newsHtml = '';
  const largeArticle = articles[0];
  const mediumArticles = articles.slice(1, 4);
  const smallArticles = articles.slice(4);

  function createArticleHtml(article, sizeClass) {
    const imageUrl = article.image_url && article.image_url.startsWith('http') ? article.image_url : 'placeholder.jpg';
    const altText = article.title ? `${article.title} - Imagen de noticia` : 'Imagen de noticia';
    const authorName = article.author || 'Autor desconocido';

    return `
      <article class="news-card ${sizeClass}">
        <img src="${imageUrl}" alt="${altText}">
        <div class="card-content">
          <h3>${article.title}</h3>
          ${sizeClass !== 'small' ? `<p>${truncateText(article.description || '', sizeClass === 'large' ? 250 : 120)}</p>` : ''}
          <span class="read-more">Leer más</span>
          <a href="${article.link}" target="_blank" class="full-card-link" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></a>
        </div>
      </article>
    `;
  }

  if (largeArticle) {
    newsHtml += `<div class="large-news-section">${createArticleHtml(largeArticle, 'large')}</div>`;
  }

  if (mediumArticles.length > 0) {
    newsHtml += '<div class="medium-news-section">';
    mediumArticles.forEach(article => {
      newsHtml += createArticleHtml(article, 'medium');
    });
    newsHtml += '</div>';
  }

  if (smallArticles.length > 0) {
    newsHtml += '<div class="small-news-section">';
    smallArticles.forEach(article => {
      newsHtml += createArticleHtml(article, 'small');
    });
    newsHtml += '</div>';
  }

  newsContainer.innerHTML = newsHtml || '<p>No hay noticias para mostrar.</p>';
}

// --- Error Handling ---
function showError(msg) {
  newsContainer.innerHTML = `<p style="color: red; text-align: center;">⚠️ ${msg}</p>`;
}

function truncateText(text, maxLength) {
  if (!text) return '';
  if (text.length <= maxLength) return text;
  const lastSpace = text.substring(0, maxLength).lastIndexOf(' ');
  return lastSpace === -1 ? text.substring(0, maxLength) + '...' : text.substring(0, lastSpace) + '...';
}       

 // (Mantener el mismo JavaScript que proporcionaste, solo actualizar la función renderNews)
        
        function renderNews(articles) {
            let newsHtml = '';
            
            articles.forEach((article, index) => {
                const sizeClass = index === 0 ? 'large' : index < 4 ? 'medium' : 'small';
                const imageUrl = article.image_url && article.image_url.startsWith('http') ? 
                    article.image_url : 
                    `https://picsum.photos/600/400?random=${index}`;

                newsHtml += `
                    <article class="news-card ${sizeClass}">
                        ${article.image_url ? 
                            `<img src="${imageUrl}" alt="${article.title}">` : 
                            `<div class="image-placeholder">Imagen no disponible</div>`}
                        <div class="card-content">
                            <h3>${article.title}</h3>
                            <p>${truncateText(article.description || '', 150)}</p>
                            <span class="read-more">Leer más</span>
                            <a href="${article.link}" target="_blank" class="full-card-link"></a>
                        </div>
                    </article>
                `;
            });

            newsContainer.innerHTML = newsHtml || '<p>No hay noticias para mostrar.</p>';
        }
    </script>
</body>
</html>
